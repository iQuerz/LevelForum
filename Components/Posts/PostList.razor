@using System.Collections.Generic

<div class="post-list">
  @if (IsLoading && (Items is null || !Items.Any()))
  {
    @* initial skeletons *@
    <div class="app-card post-skel"><div class="skel skel-title"></div><div class="skel skel-line"></div><div class="skel skel-line w-85"></div></div>
    <div class="app-card post-skel"><div class="skel skel-title"></div><div class="skel skel-line"></div><div class="skel skel-line w-85"></div></div>
    <div class="app-card post-skel"><div class="skel skel-title"></div><div class="skel skel-line"></div><div class="skel skel-line w-85"></div></div>
  }
  else if (Items is not null && Items.Any())
  {
    @foreach (var p in Items)
    {
      <PostCard Id="@p.Id"
                Title="@p.Title"
                TopicId="@p.TopicId"
                TopicTitle="@p.TopicTitle"
                AuthorName="@p.AuthorName"
                CreatedAt="@p.CreatedAt"
                Score="@p.Score"
                MyVote="@p.MyVote"
                CommentsCount="@p.CommentsCount"
                TopicLocked="@p.TopicLocked"
                VoteDisabled="@p.VoteDisabled"
                OnVote="OnVote"
                OnReport="OnReport" />
    }

    @if (ShowLoadMore)
    {
      <div class="list-loadmore">
        <button type="button" class="btn-ghost" disabled="@IsLoadingMore" @onclick="LoadMore">
          @if (IsLoadingMore) { <span class="spinner"></span> } Load more
        </button>
      </div>
    }
  }
  else
  {
    <div class="app-card empty-block">
      <div class="empty-title">No posts found</div>
      <div class="empty-sub">Try a different search or reset filters.</div>
    </div>
  }
</div>

@code{
  public record PostListItem(
      int Id, string Title, int TopicId, string TopicTitle,
      string AuthorName, DateTime CreatedAt, int Score, int? MyVote,
      int CommentsCount, bool TopicLocked, bool VoteDisabled = false);

  [Parameter] public IEnumerable<PostListItem>? Items { get; set; }

  [Parameter] public bool IsLoading { get; set; } = false;
  [Parameter] public bool ShowLoadMore { get; set; } = true;
  [Parameter] public bool IsLoadingMore { get; set; } = false;

  [Parameter] public EventCallback OnLoadMore { get; set; }
  [Parameter] public EventCallback<(int postId, int value)> OnVote { get; set; }
  [Parameter] public EventCallback<int> OnReport { get; set; }

  Task LoadMore() => OnLoadMore.InvokeAsync();
}

<style>
  .post-list{ display:flex; flex-direction:column; gap:12px }
  .list-loadmore{ display:flex; justify-content:center; margin-top:8px }
  .btn-ghost{ border:1px solid var(--border-color); background:transparent; color:var(--text);
    border-radius:10px; padding:8px 14px; cursor:pointer }
  .btn-ghost:hover{ background:rgba(255,255,255,.06) }

  /* SKELETONS (reuse your shimmer base if present) */
  .post-skel{ padding:12px }
  .skel{ background:linear-gradient(90deg, rgba(255,255,255,.06) 25%, rgba(255,255,255,.12) 37%, rgba(255,255,255,.06) 63%);
    background-size:400% 100%; animation:shimmer 1.2s ease-in-out infinite; border-radius:8px; height:14px }
  .skel-title{ height:20px; width:60%; margin-bottom:10px }
  .skel-line{ height:14px; width:100%; margin:6px 0 }
  .w-85{ width:85% }
  @@keyframes shimmer{0%{background-position:100% 0}100%{background-position:0 0}}
</style>